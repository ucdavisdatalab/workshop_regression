<!---# Generalized Linear Models

```{r import}
library(alone)

data(survivalists)
survivalists$podium = survivalists$result <= 3
```

## Generalized how?
The linear regression model fits a straight line through scatterplot data. That's a very restrictive model. The generalized linear model begins to loosen some of the restrictions by allowing the response to have a distribution other than the normal distribution.

## Distributions
Statisticians have defined distributions to describe common kinds of randomness. In regression modeling, we are primarily concerned about the distribution of the response, rather than the features.  Linear regression assumes that the residuals have a distribution that we call "normal" or "Gaussian". But there are other important distributons that are very common in applied scientific research. I'll give you a brief description of the most important distributions here, but you should talk to a statistician and/or read deeply to understand the conditions that are assumed by the response family you've selected for a model.

### Binomial
A very common kind of response is one that puts each observation in a binary class. Examples include: whether a patient survived after receiving a medical treatment, whether a plant successfully germinated, and whether a a target mineral was found in a rock sample. We call this kind of response a binomial response, and it can refer to either a single outcome, or several independent outcomes that are grouped together. An example of the second case would be a measurement of how many students from a class of 30 improved their test score after a lesson.

### Poisson
This is another type of discrete data, which is used for a very common kind of count data. When a count is of independent events with no upper limit, it's often a Poisson response. For example: how many patients were admitted to the hospital in one day with COVID-19, or how many cars drive past an intersection in one hour. There are further considerations to check with a statistician - e.g., if the events aren't independent then you may have a negative binomial response.

### Gamma
A Gamma distribution is for continuous data, which is also true of the normal distribution. But the Gamma distribution can only have positive values (not including zero), and it has greater variability when the values are greater. 


## The `glm()` function
In R, you will usually estimate a generalized linear model by the `glm()` function. Its interface is almost identical to the `lm()` function except it adds a parameter for the distribution, which is called `family`. So an example looks like this:

```{r logistic-regression-example}
logistic_model = glm(podium ~ gender * age, data=survivalists, family='binomial')
summary(logistic_model)
```

The summary reports that there is apparently no significant effect of gender, or age, nor any significant interaction between them for this data.

```{r poisson-regression-example}

```

### Summary of a GLM
To view and interpret a GLM, use the `summary()` function, just as you did for a linear model. The interpretation is extremely similar, with only minor differences that aren't worth belaboring in this introduction.


### Diagnostics for GLMs




--->

# Generalized linear regression
We won't put much emphasis on generalized linear models (GLMs) in this workshop, but they are important and so you might want to know about them. GLMs are used when the response variable has some distribution other than normal - logistic regression (binary response) is by far the most commonly used GLM and Poisson regression (count response) is fairly common, too. In any case, the differences between an ordinary linear model and a generalized linear model are fairly minor. 

- Response distribution is different. As a result:
  - Response variance is no longer assumed equal (when variance depends on mean).
  - The linear model predicts a transformed version of the mean, rather than predicting the mean itself (the mean is transformed by what's called a "Link Function").
  - Thus, diagnostics have to change.

### Logistic Regression - UC Berkeley Admissions
The `UCBAdmissions` dataset is built into R and provides a tabulation of how many men and women applied and were admitted to six departments at UC Berkeley in 1973. Suppose we want to estimate whether male or female applicants were more likely than the other to be admitted. Since each admission decision is binary, we will use a generalized linear model with binomial response to estimate the effect of gender on admission probability. The data are built-in as an array so we need to convert them to a data frame before getting started.

```{r convert-ucb-data}
library(tidyr)
ucb = as.data.frame(UCBAdmissions) |>
  pivot_wider(names_from = Admit, values_from = Freq)

ucb
```

Now fit the binomial regression model for admission probability. By default, R uses logistic regression for a binomial response. Because the observations are aggregated by gender and department, we have to pair the `Admitted` and `Rejected` columns as the response. If each row represented a single observation and the `Admitted` column were coded as 0/1 or `TRUE`/`FALSE`, we could use it alone as the response.
```{r ucb-model}
# estimate a logistic regression model.
ucb_model = glm(cbind(Admitted, Rejected) ~ Dept + Gender, data=ucb, family='binomial')

# plot the diagnostics
layout(matrix(1:4, 2, 2))
plot(ucb_model)

# show the model summary
summary(ucb_model)
```

Diagnostics are especially difficult to interpret for logistic regression models with a small amount of data. These look only OK. According to the model summary, there are significant differences in admission rates by departments and not by gender.

For a logistic regression model, the estimated coefficients are reported as log odds ratios. A log odds ratio greater than zero corresponds to probability greater than 50%, and vice versa. Both `Dept` and `Gender` are categorical, so you can figure the estimated log odds ratio for a particular combination by adding the relevant rows from the summary table. The default level of this combination is `Male` and `DeptA`.

<!---This data has often been used to illustrate Simpson's Paradox, because overall men were admitted at a greater rate than women, but this may be because women applied to more selective departments. --->





<!---
## Poisson Regression - Effectiveness of Bug Sprays

Here is an example of a Poisson regression model. 

```{r poisson-regression-insect-sprays}
model_spray = glm(count ~ spray, data=InsectSprays, family='poisson')
summary(model_spray)
plot(model_spray)
```


...)



